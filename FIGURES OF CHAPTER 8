##############
# CHAPTER 8 #
##############


#Figure 8.1 The scatterplots, graph visualizations, and rules where the item "whole milk" is on the right-hand side.

# Load necessary libraries
if (!require("arules")) install.packages("arules")
library(arules)

# Load the Groceries dataset
data("Groceries")

# Inspect the dataset
summary(Groceries)
inspect(head(Groceries, 5))  # View first 5 transactions

# Generate association rules
rules <- apriori(Groceries, 
                 parameter = list(supp = 0.01, conf = 0.5, target = "rules"))

# Inspect the rules
total_rules <- length(rules)
cat("Number of rules generated:", total_rules, "\n")

# Show top 10 rules sorted by lift
inspect(head(sort(rules, by = "lift"), 10))

# Visualize the rules (requires arulesViz package)
if (!require("arulesViz")) install.packages("arulesViz")
library(arulesViz)

plot(rules, method = "scatterplot", measure = c("support", "confidence"), shading = "lift")
plot(rules, method = "graph", control = list(type = "items"))

# Filter rules for specific insights
# Example: Rules where the item "whole milk" is in the right-hand side
milk_rules <- subset(rules, rhs %in% "whole milk")
inspect(head(sort(milk_rules, by = "lift"), 10))

# Save the rules to a CSV file
write(rules, file = "association_rules.csv", sep = ",", quote = TRUE, row.names = FALSE)


#Figure 8.2 The rules quality metric and rules with highest support, confidence, and lift for evaluation using the Groce​​ries dataset.
# Load necessary libraries
if (!require("arules")) install.packages("arules")
library(arules)

# Load the Groceries dataset
data("Groceries")

# Inspect the dataset
summary(Groceries)
inspect(head(Groceries, 5))  # View first 5 transactions

# Generate association rules
rules <- apriori(Groceries, 
                 parameter = list(supp = 0.01, conf = 0.5, target = "rules"))

# Inspect the rules
total_rules <- length(rules)
cat("Number of rules generated:", total_rules, "\n")

# Show top 10 rules sorted by lift
inspect(head(sort(rules, by = "lift"), 10))

# Visualize the rules (requires arulesViz package)
if (!require("arulesViz")) install.packages("arulesViz")
library(arulesViz)

plot(rules, method = "scatterplot", measure = c("support", "confidence"), shading = "lift")
plot(rules, method = "graph", control = list(type = "items"))

# Filter rules for specific insights
# Example: Rules where the item "whole milk" is in the right-hand side
milk_rules <- subset(rules, rhs %in% "whole milk")
inspect(head(sort(milk_rules, by = "lift"), 10))

# Save the rules to a CSV file
write(rules, file = "association_rules.csv", sep = ",", quote = TRUE, row.names = FALSE)

# ==============================
# Model Evaluation and Validation
# ==============================

# Evaluate quality of rules
rule_quality <- quality(rules)
cat("Summary of rule quality metrics:\n")
summary(rule_quality)

# Analyze rules with the highest support, confidence, and lift
cat("\nRules with highest support:\n")
inspect(head(sort(rules, by = "support"), 5))

cat("\nRules with highest confidence:\n")
inspect(head(sort(rules, by = "confidence"), 5))

cat("\nRules with highest lift:\n")
inspect(head(sort(rules, by = "lift"), 5))

# Validate rules: Filter rules with support > 0.02 and confidence > 0.6
validated_rules <- subset(rules, subset = support > 0.02 & confidence > 0.6)
cat("\nNumber of validated rules:", length(validated_rules), "\n")
inspect(head(sort(validated_rules, by = "lift"), 10))

# Validation for specific use case: Check if the rule set includes relationships with "yogurt"
yogurt_rules <- subset(validated_rules, lhs %in% "yogurt" | rhs %in% "yogurt")
cat("\nNumber of rules involving 'yogurt':", length(yogurt_rules), "\n")
inspect(head(sort(yogurt_rules, by = "confidence"), 5))
