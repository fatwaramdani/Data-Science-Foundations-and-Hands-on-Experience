##############
# CHAPTER 8 #
##############

# Figure 8.1 The illustration of the top 20 most frequent items, distribution of transaction sizes, item frequency (support > 5%), and matrix of the first 100 transactions using the Groceries dataset that is preloaded with the arules package. It contains transactional data for a supermarket.
# Load required libraries
library(arules)
library(arulesViz)

# Load the Groceries dataset
data("Groceries")

# Check the structure of the dataset
summary(Groceries)

# Basic information about the dataset
cat("Number of transactions: ", length(Groceries), "\n")
cat("Number of items: ", length(itemLabels(Groceries)), "\n")

# Inspecting a few transactions
inspect(Groceries[1:5])

# Top items by frequency
itemFrequencyPlot(Groceries, topN = 20, col = "steelblue", 
                  main = "Top 20 Most Frequent Items", 
                  ylab = "Proportion", 
                  xlab = "Items")

# Distribution of transaction sizes
transaction_sizes <- size(Groceries)
hist(transaction_sizes, breaks = 20, col = "lightblue", 
     main = "Distribution of Transaction Sizes", 
     xlab = "Number of Items per Transaction")

# Summary statistics of transaction sizes
summary(transaction_sizes)

# Visualize item frequency (word cloud-like plot)
itemFrequencyPlot(Groceries, support = 0.05, 
                  col = rainbow(10), 
                  main = "Item Frequency (Support > 5%)")

# Association rules (basic example for visualization)
rules <- apriori(Groceries, parameter = list(support = 0.01, confidence = 0.5))
summary(rules)

# Plot the top 10 rules
inspect(sort(rules, by = "lift")[1:10])
plot(rules[1:10], method = "graph", control = list(type = "items"))

# Plot a matrix of items and transactions
image(Groceries[1:100], main = "Matrix of First 100 Transactions", xlab = "Items", ylab = "Transactions")



#Figure 8.1 The scatterplots, graph visualizations, and rules where the item "whole milk" is on the right-hand side.

# Load necessary libraries
if (!require("arules")) install.packages("arules")
library(arules)

# Load the Groceries dataset
data("Groceries")

# Inspect the dataset
summary(Groceries)
inspect(head(Groceries, 5))  # View first 5 transactions

# Generate association rules
rules <- apriori(Groceries, 
                 parameter = list(supp = 0.01, conf = 0.5, target = "rules"))

# Inspect the rules
total_rules <- length(rules)
cat("Number of rules generated:", total_rules, "\n")

# Show top 10 rules sorted by lift
inspect(head(sort(rules, by = "lift"), 10))

# Visualize the rules (requires arulesViz package)
if (!require("arulesViz")) install.packages("arulesViz")
library(arulesViz)

plot(rules, method = "scatterplot", measure = c("support", "confidence"), shading = "lift")
plot(rules, method = "graph", control = list(type = "items"))

# Filter rules for specific insights
# Example: Rules where the item "whole milk" is in the right-hand side
milk_rules <- subset(rules, rhs %in% "whole milk")
inspect(head(sort(milk_rules, by = "lift"), 10))

# Save the rules to a CSV file
write(rules, file = "association_rules.csv", sep = ",", quote = TRUE, row.names = FALSE)


#Figure 8.2 The rules quality metric and rules with highest support, confidence, and lift for evaluation using the Groce​​ries dataset.
# Load necessary libraries
if (!require("arules")) install.packages("arules")
library(arules)

# Load the Groceries dataset
data("Groceries")

# Inspect the dataset
summary(Groceries)
inspect(head(Groceries, 5))  # View first 5 transactions

# Generate association rules
rules <- apriori(Groceries, 
                 parameter = list(supp = 0.01, conf = 0.5, target = "rules"))

# Inspect the rules
total_rules <- length(rules)
cat("Number of rules generated:", total_rules, "\n")

# Show top 10 rules sorted by lift
inspect(head(sort(rules, by = "lift"), 10))

# Visualize the rules (requires arulesViz package)
if (!require("arulesViz")) install.packages("arulesViz")
library(arulesViz)

plot(rules, method = "scatterplot", measure = c("support", "confidence"), shading = "lift")
plot(rules, method = "graph", control = list(type = "items"))

# Filter rules for specific insights
# Example: Rules where the item "whole milk" is in the right-hand side
milk_rules <- subset(rules, rhs %in% "whole milk")
inspect(head(sort(milk_rules, by = "lift"), 10))

# Save the rules to a CSV file
write(rules, file = "association_rules.csv", sep = ",", quote = TRUE, row.names = FALSE)

# ==============================
# Model Evaluation and Validation
# ==============================

# Evaluate quality of rules
rule_quality <- quality(rules)
cat("Summary of rule quality metrics:\n")
summary(rule_quality)

# Analyze rules with the highest support, confidence, and lift
cat("\nRules with highest support:\n")
inspect(head(sort(rules, by = "support"), 5))

cat("\nRules with highest confidence:\n")
inspect(head(sort(rules, by = "confidence"), 5))

cat("\nRules with highest lift:\n")
inspect(head(sort(rules, by = "lift"), 5))

# Validate rules: Filter rules with support > 0.02 and confidence > 0.6
validated_rules <- subset(rules, subset = support > 0.02 & confidence > 0.6)
cat("\nNumber of validated rules:", length(validated_rules), "\n")
inspect(head(sort(validated_rules, by = "lift"), 10))

# Validation for specific use case: Check if the rule set includes relationships with "yogurt"
yogurt_rules <- subset(validated_rules, lhs %in% "yogurt" | rhs %in% "yogurt")
cat("\nNumber of rules involving 'yogurt':", length(yogurt_rules), "\n")
inspect(head(sort(yogurt_rules, by = "confidence"), 5))
